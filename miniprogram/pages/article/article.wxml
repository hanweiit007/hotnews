<view class="container">
  <!-- 加载状态 -->
  <view wx:if="{{loading}}" class="loading-container">
    <view class="loading-spinner"></view>
    <text class="loading-text">加载中...</text>
  </view>

  <!-- 错误状态 -->
  <view wx:elif="{{error}}" class="error-container">
    <view class="error-icon">⚠️</view>
    <text class="error-title">内容加载失败</text>
    <text class="error-message">抱歉，暂时无法获取文章内容</text>
    <view class="error-tips">
      <text>• 检查网络连接是否正常</text>
      <text>• 可以尝试重新加载</text>
      <text>• 或复制链接到浏览器查看</text>
    </view>
    <view class="error-actions">
      <button class="retry-btn" bindtap="reload">重新加载</button>
      <button class="copy-btn" bindtap="copyLink">复制链接</button>
    </view>
  </view>

  <!-- 富文本模式 -->
  <view wx:elif="{{displayMode === 'rich-text'}}" class="rich-text-container">
    <!-- 模式指示器 -->
    <view wx:if="{{showModeIndicator}}" class="mode-indicator rich-text-mode">
      <text class="mode-text">📝 富文本模式</text>
    </view>
    
    <!-- 文章标题 -->
    <view class="article-header">
      <text class="article-title">{{title}}</text>
      <view class="article-actions">
        <button class="action-btn" bindtap="copyLink">📋 复制链接</button>
      </view>
    </view>

    <!-- 平台跳转按钮 -->
    <view wx:if="{{platformInfo && platformInfo.canJump}}" class="platform-jump">
      <view class="platform-info-bar">
        <text class="platform-icon">{{platformInfo.icon}}</text>
        <view class="platform-text">
          <text class="platform-name">{{platformInfo.name}}</text>
          <text class="platform-desc">✨ {{platformInfo.jumpText}}</text>
        </view>
      </view>
      <button class="jump-btn" style="background: {{platformInfo.color}}" bindtap="jumpToPlatform">
        🚀 {{platformInfo.jumpText}}
      </button>
    </view>

    <!-- 文章内容 -->
    <view class="article-content">
      <rich-text wx:if="{{content}}" nodes="{{content}}" class="rich-text"></rich-text>
      <view wx:else class="no-content">
        <view class="no-content-icon">📖</view>
        <text class="no-content-text">内容加载中...</text>
      </view>
    </view>

    <!-- 底部提示 -->
    <view class="article-footer">
      <text class="footer-text">💡 内容来源于原始链接，已优化为文本格式</text>
    </view>
  </view>

  <!-- 代理网页模式 -->
  <view wx:elif="{{displayMode === 'proxy-webview'}}" class="proxy-webview-container">
    <!-- 模式指示器 -->
    <view wx:if="{{showModeIndicator}}" class="mode-indicator proxy-mode">
      <text class="mode-text">🌐 代理网页模式</text>
    </view>
    
    <!-- 代理内容显示 -->
    <view wx:if="{{showProxyContent}}" class="proxy-content-modal">
      <view class="proxy-content-header">
        <view class="header-info">
          <text class="header-title">📄 代理网页内容</text>
          <text class="header-subtitle">已优化移动端显示</text>
        </view>
        <button size="mini" bindtap="closeProxyContent" class="close-btn">✕</button>
      </view>
      <scroll-view scroll-y class="proxy-content-body" enhanced="{{true}}" show-scrollbar="{{false}}">
        <view class="content-wrapper">
          <rich-text nodes="{{proxyHtmlContent}}" class="rich-text"></rich-text>
          <view class="content-end">
            <view class="end-indicator">📖 内容已全部加载</view>
            <text class="content-info">通过代理服务器获取 • {{proxyHtmlContent.length}} 字符</text>
          </view>
        </view>
      </scroll-view>
    </view>
    
    <!-- 加载中状态 -->
    <view wx:else class="proxy-loading-container">
      <view class="loading-card">
        <view class="loading-animation">
          <view class="loading-ring"></view>
          <view class="loading-ring"></view>
          <view class="loading-ring"></view>
        </view>
        <text class="loading-title">🚀 正在获取网页内容</text>
        <text class="loading-desc">通过代理服务器突破限制，为您呈现完整内容</text>
        <view class="loading-steps">
          <view class="step step-active">
            <view class="step-dot"></view>
            <text>连接代理服务器</text>
          </view>
          <view class="step step-active">
            <view class="step-dot"></view>
            <text>获取网页内容</text>
          </view>
          <view class="step">
            <view class="step-dot"></view>
            <text>优化移动端显示</text>
          </view>
        </view>
      </view>
    </view>
    
    <!-- webview组件（备用，通常不工作） -->
    <web-view 
      wx:if="{{false}}"
      src="{{proxyUrl}}" 
      class="webview" 
      bindload="onWebviewLoad"
      binderror="onWebviewError"
      bindmessage="onWebviewMessage"
    ></web-view>
  </view>

  <!-- 直接网页模式 -->
  <view wx:elif="{{displayMode === 'direct-webview'}}" class="direct-webview-container">
    <!-- 模式指示器 -->
    <view wx:if="{{showModeIndicator}}" class="mode-indicator direct-mode">
      <text class="mode-text">直接网页模式</text>
    </view>
    
    <!-- webview组件 -->
    <web-view 
      src="{{url}}" 
      class="webview" 
      bindload="onWebviewLoad"
      binderror="onWebviewError"
      bindmessage="onWebviewMessage"
    ></web-view>
  </view>

  <!-- 未知模式 -->
  <view wx:else class="unknown-mode-container">
    <view class="error-container">
      <view class="error-icon">❓</view>
      <text class="error-title">未知显示模式</text>
      <text class="error-message">当前显示模式：{{displayMode}}</text>
      <button class="retry-btn" bindtap="reload">重新加载</button>
    </view>
  </view>
</view>
